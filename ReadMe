This package is aiming to analyze intestinal images from CODEX. The method is impletmented in a shiny-based web application: https://beta.fastgenomics.org/analyses/detail-analysis-4e08a29e8d3c426698f96111065e75b5

This script is inspired by this paper: https://www.nature.com/articles/s41467-022-28497-0. 
"Conversion to linear coordinate system Images of HE-stained day 0 colon tissue section were first downscaled to 600 × 541 pixels. Next, the outer edge of the muscularis externa was manually outlined using a 1 pixel diameter brush in Photoshop and defined as the base layer, that is, the base of the y-axis in the new coordinate system. All subsequent steps were computed in R (v.4.0.0). The outlined base layer was imported into R and converted into an unordered set of points (pixel coordinates), each point defining a position on the base layer. In order to define the new coordinate system we aimed to (1) define the endpoints of the base layer and (2) order the points of the base layer from distal to proximal. To solve this problem, a kd-tree based k Nearest Neighbor algorithm (kNN, dbscan R package) was used to construct an adjacency matrix with k set to 5. One attribute that is unique to the end points is that they only have neighbors in one direction along the base layer. Therefore, the end points could be defined by searching for the 2 points with the smallest average distance to its 5 nearest neighbors. Next, the knn adjacency matrix was converted into an undirected, connected graph (graph_from_adjacency_matrix, igraph R package). From this graph, the shortest path (geodesic) from endpoint to endpoint was detected, that is, the path with the minimal number of vertices (shortest_paths, igraph R package). The ordered subset of vertices from the shortest path was then used to order the base layer point set from the proximal to the distal end point.

Visium spots were assigned to base layer pixel coordinates using the following steps. First, to limit the search space for each base layer pixel coordinate, only spots within an 80-pixel radius were considered. The search space was further limited by selecting spots with an angle to the tangent to the curve at the base layer point ranging between 35°-125°. The result of this iterative search was a set of base layer points and neighboring Visium spot pairs. To ensure that each Visium spot only paired with one base layer point, only the pair with the smallest Euclidean distance were kept. Finally, x-coordinates of Visium spots in the unrolled coordinate system were defined as the order of the base layer points and the y-coordinate was defined as the distance between Visium spots to the closest base layer point."
